# ATAW-Chat
这是用 C++ 和 Qt 实现的一款聊天软件，整个软件包含服务器端和客户端，
## 总体架构
整个程序基于C/S模型实现，程序运行过程中有一台服务器和多台客户端。客户端之间不能直接通信，
所有的消息都必须先经过服务器，服务器对消息进行解析，根据消息类型做出相应的处理。服务器在整个过程中充当着中转站的角色。

### 体系架构图

![](/run/media/root/study/kaiyuan/MyChat/readme_image/jiagou.jpg)



![](/run/media/root/study/kaiyuan/MyChat/readme_image/server_jiagou.png)



![](/run/media/root/study/kaiyuan/MyChat/readme_image/all_jiagou.png)

## 功能实现
- 注册
- 登陆
- 修改登录密码
- 搜索
- 添加好友，删除好友
- 好友和群分组管理
- 添加群，退出群，创建群
- 私聊和群聊，支持以下消息类型
  - 普通文本消息
  - 图片
  - 文件
- 本地历史消息记录和加载
- 截图（正在实现中）
由于时间有限，目前只能说是实现了非常基本的一些功能，后续有时间可能会加以完善。
## 数据库设计
为了减少访问服务器的频率，需要在本地缓存一些信息，客户端也需要设计数据库，目前客户端只设计了4张表：好友分组，我的好友，我的群，历史消息
服务器端的数据库记录着所有用户和群的信息，用户之间的好友关系，用户和群的所属关系，用户发送的消息，用户发送的文件等

## 类消息传递
由于整个界面的类结构比较复杂，事实上整个界面是经过多层堆叠形成的效果，所以存在着很多变量之间不能直接访问的问题，但是程序运行期间很多类之间又必须需要通信，比如整个客户端程序只存在一个发送普通消息的socket类，在登陆界面初始化该类，并且用于发送登陆消息，等登陆结束后，需要把这个类传递给主界面类，然后主界面类里面又包含几个子类，主界面收到消息需要交给子类处理，子类也有消息传递给主界面类进行发送，故需要使用一种消息传递机制来达成这种通信目的。
## 消息封装
整个软件运行过程中会存在多种消息类型，比如登陆，注册，修改密码，获取群成员，加好友，加群，删好友，退群等等。必须使用一种通用的消息封装格式，使得服务器能够快速解析出各种消息并且进行相应处理，同时还要有足够的可拓展性，以便以后添加新的功能。
为此，服务器和客户端需要同时定义一组枚举变量，代表不同的消息类型。
## 服务器消息解析
客户端发给服务器的各种消息都是用Json封装过的。服务器在收到消息后，首先提取其中的“消息类型”字段，通过判断消息类型来分别来调用不同的函数处理。
## ATAW Server
### ui初步设计

#### 登录界面

![](/run/media/root/study/kaiyuan/MyChat/readme_image/server_login.png)

#### 主界面

![](/run/media/root/study/kaiyuan/MyChat/readme_image/server_main.png)

### 功能实现（正在实现）
#### 上下线
下线后可再次登录 一直上线会显示重复登录
#### 数据管理（用户管理 信息
#### 消息转发、文件转发
文件传输采用Tcp协议进行，因为要保证文件不会丢失任何一个字节或者任何一位错乱。
文件传输耗时较长，不能当作普通的消息处理，必须单独用一个线程去处理，否则一定有文件要发送或者有文件要接收，整个程序就会阻塞，无法进行其他操作。由于存在多个聊天对话框同时发送文件的使用场景，故需要为每一个聊天窗口单独分配一个发送文件的socket类，同时考虑到这样做可能造成过多的内存占用，所以只有当用户点击进入聊天对话框时才开始分配这个资源。

## ATAW Client
### ui初步设计
界面采用自定义界面，准备仿QQ和wechat
#### 登陆界面设计
添加页面旋转功能

![](/run/media/root/study/kaiyuan/MyChat/readme_image/client_login.png)



![](/run/media/root/study/kaiyuan/MyChat/readme_image/clent_net.png)

### 主页面设计

![](/run/media/root/study/kaiyuan/MyChat/readme_image/client_main.png)

![](/run/media/root/study/kaiyuan/MyChat/readme_image/clent_chat.png)

![](/run/media/root/study/kaiyuan/MyChat/readme_image/clent_contact.png)

### 功能实现（正在实现）

#### 添加好友

#### 好友的群聊（多对多，消息通过服务器转发，（不支持文件发送））  
#### 消息转发、文件转发
